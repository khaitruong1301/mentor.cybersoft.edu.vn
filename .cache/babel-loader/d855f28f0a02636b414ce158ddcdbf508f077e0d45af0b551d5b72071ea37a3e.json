{"ast":null,"code":"import _regeneratorRuntime from\"D:/BIG-PROJECT/WIKI/FE/crmmentor/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"D:/BIG-PROJECT/WIKI/FE/crmmentor/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";//rxslice\nimport{createSlice,current}from'@reduxjs/toolkit';import{AdminService}from'../../services/AdminService';import{NguoiDungService}from'../../services/NguoiDungService';import{USER_LOGIN}from'../../utils/constant';import{history}from'../../utils/history';import{checkQuyenUser}from'../../utils/SelectOption';import{callApiChiNhanh,callApiLopHoc}from'./lopHocReducer';import{callApiKhachHang,callApiNguoiDung}from'./userReducer';var initialState={roleCom:null,dsQuyen:[],dsConfig:[]};var adminReducer=createSlice({name:\"adminReducer\",initialState:initialState,reducers:{getDanhSachQuyen:function getDanhSachQuyen(state,_ref){var type=_ref.type,payload=_ref.payload;state.dsQuyen=payload;},getDanhSachConfig:function getDanhSachConfig(state,_ref2){var type=_ref2.type,payload=_ref2.payload;state.dsConfig=payload;},setRoleCom:function setRoleCom(state,_ref3){var type=_ref3.type,payload=_ref3.payload;var nguoiDung={\"id\":\"b9376497-1678-42e0-b8f8-d5ccaa03274f\",\"email\":\"admin@gmail.com\",\"hoTen\":\"Admin\",\"biDanh\":\"admin\",\"soDT\":\"0941237751\",\"facebookId\":\"\",\"avatar\":\"/static/user-icon.png\",\"urls\":\"$2b$10$/nRixjwK7lXUJ9M1jrjh4Oh0dfyyE4ecCkZWH0Yuh69NWoo0gkLhK\",\"token\":\"eyJhbGciOiJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzA0L3htbGRzaWctbW9yZSNobWFjLXNoYTI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy5taWNyb3NvZnQuY29tL3dzLzIwMDgvMDYvaWRlbnRpdHkvY2xhaW1zL2V4cGlyZWQiOiIxMC8yMi8yMDQ1IDEwOjM3OjU1IFBNIiwiaHR0cDovL3NjaGVtYXMueG1sc29hcC5vcmcvd3MvMjAwNS8wNS9pZGVudGl0eS9jbGFpbXMvbmFtZSI6ImI5Mzc2NDk3LTE2NzgtNDJlMC1iOGY4LWQ1Y2NhYTAzMjc0ZiIsImh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDUvMDUvaWRlbnRpdHkvY2xhaW1zL2VtYWlsYWRkcmVzcyI6ImFkbWluQGdtYWlsLmNvbSIsImh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vd3MvMjAwOC8wNi9pZGVudGl0eS9jbGFpbXMvcm9sZSI6WyJDX0tIIiwiQU5ZIiwiQ19MTCIsIkNfTE9QIiwiQ19ORCIsIkNIRUNLX01FTlRPUl9MT1AiLCJEX0RBTkgiLCJEX0tIIiwiRF9MTCIsIkRfTkQiLCJGX0dDIiwiRl9MT1AiLCJHRF9MSCIsIktfVFQiLCJOX1FVWUVOIiwiUUxfQkwiLCJRTF9CTSIsIlFMX0NMIiwiUUxfR0MiLCJRTF9ITVQiLCJRTF9LSCIsIlFMX0xUIiwiUUxfVFQiLCJSX0JIIiwiUl9LSCIsIlJfTEwiLCJSX0xPUCIsIlJfTkQiLCJSX1ZMIiwiVV9LSCIsIlVfTEwiLCJVX0xPUCIsIlVfTkQiLCJYX0tIX0wiLCJRTF9MQ04iLCJRTF9US0QiLCJRTF9DSFRMIiwiUUxfUk0iLCJEX0JUIl0sIm5iZiI6MTY2NjQ1MzA3NSwiZXhwIjoxNjY2NDU2Njc1fQ.fIwoFacMNwqu0nkUD7oXCUfusiBD9voE0PnQDtR1d3A\",\"thongTinMoRong\":\"\",\"danhSachLopHoc\":\"[\\\"258\\\",\\\"258\\\",\\\"254\\\",\\\"282\\\"]\",\"thongTinLopHoc\":null,\"maNhomQuyen\":\"SPADMIN\",\"ngayTao\":\"2/21/2020 1:22:51 AM\",\"color\":\"black\",\"nuocNgoai\":false};NguoiDungService.checkPassService(nguoiDung).then(function(res){if(res.data.content==\"0\"){localStorage.removeItem(USER_LOGIN);history.push(\"/login\");return;}}).catch(function(err){history.push(\"/login\");return;});var _current=current(state),dsQuyen=_current.dsQuyen;if(dsQuyen.length>0){state.roleCom=payload;//check quyen hay ko\nif(!checkQuyenUser(dsQuyen,payload)){history.push(\"/login\");}}else{var _window$location=window.location,pathname=_window$location.pathname,search=_window$location.search;pathname!=\"/\"&&localStorage.setItem(\"url_redirect\",pathname+search);history.push(\"/h\");}}}});//quản lý actions\nvar _adminReducer$actions=adminReducer.actions,getDanhSachQuyen=_adminReducer$actions.getDanhSachQuyen,getNhomQuyen=_adminReducer$actions.getNhomQuyen,setRoleCom=_adminReducer$actions.setRoleCom,getDanhSachConfig=_adminReducer$actions.getDanhSachConfig;export{getDanhSachQuyen,getNhomQuyen,setRoleCom,getDanhSachConfig};export default adminReducer.reducer;//setup redux thunk\n//closure function\nexport var callApiQuyen=function callApiQuyen(userId){return/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(dispatch){var apiQuyen;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return AdminService.layQuyenUserService(userId);case 2:apiQuyen=_context.sent;dispatch(getDanhSachQuyen(apiQuyen.data.content));case 4:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref4.apply(this,arguments);};}();};export var callApiConfig=function callApiConfig(){return/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(dispatch){var apiConfig;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return AdminService.layDanhSachConfigService();case 2:apiConfig=_context2.sent;dispatch(getDanhSachConfig(apiConfig.data.content));case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref5.apply(this,arguments);};}();};","map":{"version":3,"names":["createSlice","current","AdminService","NguoiDungService","USER_LOGIN","history","checkQuyenUser","callApiChiNhanh","callApiLopHoc","callApiKhachHang","callApiNguoiDung","initialState","roleCom","dsQuyen","dsConfig","adminReducer","name","reducers","getDanhSachQuyen","state","type","payload","getDanhSachConfig","setRoleCom","nguoiDung","checkPassService","then","res","data","content","localStorage","removeItem","push","catch","err","length","window","location","pathname","search","setItem","actions","getNhomQuyen","reducer","callApiQuyen","userId","dispatch","layQuyenUserService","apiQuyen","callApiConfig","layDanhSachConfigService","apiConfig"],"sources":["D:/BIG-PROJECT/WIKI/FE/crmmentor/src/redux/reducers/adminReducer.js"],"sourcesContent":["//rxslice\r\nimport { createSlice, current } from '@reduxjs/toolkit';\r\nimport { AdminService } from '../../services/AdminService';\r\nimport { NguoiDungService } from '../../services/NguoiDungService';\r\nimport { USER_LOGIN } from '../../utils/constant';\r\nimport { history } from '../../utils/history';\r\nimport { checkQuyenUser } from '../../utils/SelectOption';\r\nimport { callApiChiNhanh, callApiLopHoc } from './lopHocReducer';\r\nimport { callApiKhachHang, callApiNguoiDung } from './userReducer';\r\n\r\nconst initialState = {\r\n  roleCom: null,\r\n  dsQuyen: [],\r\n  dsConfig:[]\r\n};\r\n\r\nconst adminReducer = createSlice({\r\n  name: \"adminReducer\",\r\n  initialState,\r\n  reducers: {\r\n    getDanhSachQuyen: (state, { type, payload }) => {\r\n      state.dsQuyen = payload;\r\n    },\r\n    getDanhSachConfig: (state, { type, payload }) => {\r\n      state.dsConfig = payload;\r\n    },\r\n    setRoleCom: (state, { type, payload }) => {\r\n\r\n\r\n      let nguoiDung = { \"id\": \"b9376497-1678-42e0-b8f8-d5ccaa03274f\", \"email\": \"admin@gmail.com\", \"hoTen\": \"Admin\", \"biDanh\": \"admin\", \"soDT\": \"0941237751\", \"facebookId\": \"\", \"avatar\": \"/static/user-icon.png\", \"urls\": \"$2b$10$/nRixjwK7lXUJ9M1jrjh4Oh0dfyyE4ecCkZWH0Yuh69NWoo0gkLhK\", \"token\": \"eyJhbGciOiJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzA0L3htbGRzaWctbW9yZSNobWFjLXNoYTI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy5taWNyb3NvZnQuY29tL3dzLzIwMDgvMDYvaWRlbnRpdHkvY2xhaW1zL2V4cGlyZWQiOiIxMC8yMi8yMDQ1IDEwOjM3OjU1IFBNIiwiaHR0cDovL3NjaGVtYXMueG1sc29hcC5vcmcvd3MvMjAwNS8wNS9pZGVudGl0eS9jbGFpbXMvbmFtZSI6ImI5Mzc2NDk3LTE2NzgtNDJlMC1iOGY4LWQ1Y2NhYTAzMjc0ZiIsImh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDUvMDUvaWRlbnRpdHkvY2xhaW1zL2VtYWlsYWRkcmVzcyI6ImFkbWluQGdtYWlsLmNvbSIsImh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vd3MvMjAwOC8wNi9pZGVudGl0eS9jbGFpbXMvcm9sZSI6WyJDX0tIIiwiQU5ZIiwiQ19MTCIsIkNfTE9QIiwiQ19ORCIsIkNIRUNLX01FTlRPUl9MT1AiLCJEX0RBTkgiLCJEX0tIIiwiRF9MTCIsIkRfTkQiLCJGX0dDIiwiRl9MT1AiLCJHRF9MSCIsIktfVFQiLCJOX1FVWUVOIiwiUUxfQkwiLCJRTF9CTSIsIlFMX0NMIiwiUUxfR0MiLCJRTF9ITVQiLCJRTF9LSCIsIlFMX0xUIiwiUUxfVFQiLCJSX0JIIiwiUl9LSCIsIlJfTEwiLCJSX0xPUCIsIlJfTkQiLCJSX1ZMIiwiVV9LSCIsIlVfTEwiLCJVX0xPUCIsIlVfTkQiLCJYX0tIX0wiLCJRTF9MQ04iLCJRTF9US0QiLCJRTF9DSFRMIiwiUUxfUk0iLCJEX0JUIl0sIm5iZiI6MTY2NjQ1MzA3NSwiZXhwIjoxNjY2NDU2Njc1fQ.fIwoFacMNwqu0nkUD7oXCUfusiBD9voE0PnQDtR1d3A\", \"thongTinMoRong\": \"\", \"danhSachLopHoc\": \"[\\\"258\\\",\\\"258\\\",\\\"254\\\",\\\"282\\\"]\", \"thongTinLopHoc\": null, \"maNhomQuyen\": \"SPADMIN\", \"ngayTao\": \"2/21/2020 1:22:51 AM\", \"color\": \"black\", \"nuocNgoai\": false };\r\n\r\n      NguoiDungService.checkPassService(nguoiDung).then(res => {\r\n\r\n        if (res.data.content == \"0\") {\r\n          localStorage.removeItem(USER_LOGIN);\r\n          history.push(\"/login\");\r\n          return;\r\n        }\r\n\r\n\r\n      }).catch(err => {\r\n        history.push(\"/login\");\r\n        return\r\n      })\r\n\r\n      const { dsQuyen } = current(state);\r\n\r\n      if (dsQuyen.length > 0) {\r\n        state.roleCom = payload;\r\n\r\n        //check quyen hay ko\r\n        if (!checkQuyenUser(dsQuyen, payload)) {\r\n          history.push(\"/login\")\r\n\r\n        }\r\n      } else {\r\n\r\n        let { pathname, search } = window.location;\r\n        pathname != \"/\" && localStorage.setItem(\"url_redirect\", pathname + search);\r\n        history.push(\"/h\")\r\n      }\r\n\r\n\r\n    },\r\n  }\r\n});\r\n\r\n//quản lý actions\r\nexport const {\r\n  getDanhSachQuyen,\r\n  getNhomQuyen,\r\n  setRoleCom,\r\n  getDanhSachConfig\r\n} = adminReducer.actions\r\n\r\nexport default adminReducer.reducer\r\n\r\n\r\n//setup redux thunk\r\n\r\n//closure function\r\nexport const callApiQuyen = (userId) => async (dispatch) => {\r\n  const apiQuyen = await AdminService.layQuyenUserService(userId);\r\n\r\n  dispatch(getDanhSachQuyen(apiQuyen.data.content));\r\n}\r\n\r\nexport const callApiConfig = () => async (dispatch) => {\r\n  const apiConfig = await AdminService.layDanhSachConfigService();\r\n\r\n  dispatch(getDanhSachConfig(apiConfig.data.content));\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}