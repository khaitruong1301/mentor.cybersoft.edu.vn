{"ast":null,"code":"import _regeneratorRuntime from\"D:/BIG-PROJECT/WIKI/FE/crmmentor/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"D:/BIG-PROJECT/WIKI/FE/crmmentor/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"D:/BIG-PROJECT/WIKI/FE/crmmentor/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect}from\"react\";import{useDispatch,useSelector}from\"react-redux\";import{Outlet,useSearchParams}from\"react-router-dom\";import{callApiQuyen}from\"../../redux/reducers/adminReducer\";import Header from\"./Header\";import{checkQuyenUser}from\"../../utils/SelectOption\";import axios from\"axios\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function Layout(){var _useSearchParams=useSearchParams(),_useSearchParams2=_slicedToArray(_useSearchParams,2),searchParams=_useSearchParams2[0],setSearchParams=_useSearchParams2[1];var token=searchParams.get(\"inf\");// chuyen che do debug de khong bi da ve google.com\nvar IS_NOT_DEBUG=true;var getQuyenUserVaCheck=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(tokenLocal){var res,checkQuyen;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return axios({method:\"GET\",url:\"https://apicrm.cybersoft.edu.vn/api/quyen/lay-quyen-user\",headers:{Authorization:\"Bearer \".concat(tokenLocal)}});case 3:res=_context.sent;// console.log(res)\ncheckQuyen=checkQuyenUser(res.data.content,\"XL_MT\");if(!checkQuyen){// alert(\"Bạn không có quyền xem lớp học này\");\nif(IS_NOT_DEBUG)window.location=\"https://www.google.com/\";}_context.next=12;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](0);console.log(_context.t0);if(IS_NOT_DEBUG)window.location=\"https://www.google.com/\";case 12:case\"end\":return _context.stop();}}},_callee,null,[[0,8]]);}));return function getQuyenUserVaCheck(_x){return _ref.apply(this,arguments);};}();useEffect(function(){// check local xem có token chưa\n// 4 case : có local mà không có url, có local và có url, có url không có local, không có cả 2\nvar tokenLocal=localStorage.getItem(\"USER_TOKEN\");if(!tokenLocal&&token){localStorage.setItem(\"USER_TOKEN\",token);getQuyenUserVaCheck(tokenLocal);}else if(!tokenLocal&&!token){if(IS_NOT_DEBUG)window.location=\"https://www.google.com/\";}else if(tokenLocal&&!token){getQuyenUserVaCheck(tokenLocal);}else if(tokenLocal&&token){localStorage.setItem(\"USER_TOKEN\",token);getQuyenUserVaCheck(token||tokenLocal);}},[token]);return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Header,{}),/*#__PURE__*/_jsx(Outlet,{})]});}","map":{"version":3,"names":["React","useEffect","useDispatch","useSelector","Outlet","useSearchParams","callApiQuyen","Header","checkQuyenUser","axios","Layout","searchParams","setSearchParams","token","get","IS_NOT_DEBUG","getQuyenUserVaCheck","tokenLocal","method","url","headers","Authorization","res","checkQuyen","data","content","window","location","console","log","localStorage","getItem","setItem"],"sources":["D:/BIG-PROJECT/WIKI/FE/crmmentor/src/templates/users/Layout.jsx"],"sourcesContent":["import React, { useEffect } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { Outlet, useSearchParams } from \"react-router-dom\";\r\nimport { callApiQuyen } from \"../../redux/reducers/adminReducer\";\r\nimport Header from \"./Header\";\r\nimport { checkQuyenUser } from \"../../utils/SelectOption\";\r\nimport axios from \"axios\";\r\n \r\nexport default function Layout() {\r\n  const [searchParams, setSearchParams] = useSearchParams();\r\n  const token = searchParams.get(\"inf\");\r\n  // chuyen che do debug de khong bi da ve google.com\r\n  const IS_NOT_DEBUG = true\r\n  const getQuyenUserVaCheck = async (tokenLocal) => {\r\n    try {\r\n      const res = await axios({\r\n        method: \"GET\",\r\n        url: \"https://apicrm.cybersoft.edu.vn/api/quyen/lay-quyen-user\",\r\n        headers: {\r\n          Authorization: `Bearer ${tokenLocal}`,\r\n        },\r\n      });\r\n      // console.log(res)\r\n      const checkQuyen = checkQuyenUser(res.data.content, \"XL_MT\");\r\n      if (!checkQuyen) {\r\n        // alert(\"Bạn không có quyền xem lớp học này\");\r\n        if (IS_NOT_DEBUG)    window.location = \"https://www.google.com/\";\r\n      }\r\n    } catch (error) {\r\n      console.log(error);\r\n      if (IS_NOT_DEBUG)  window.location = \"https://www.google.com/\";\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    // check local xem có token chưa\r\n    // 4 case : có local mà không có url, có local và có url, có url không có local, không có cả 2\r\n    const tokenLocal = localStorage.getItem(\"USER_TOKEN\");\r\n    if (!tokenLocal && token) {\r\n      localStorage.setItem(\"USER_TOKEN\", token);\r\n      getQuyenUserVaCheck(tokenLocal);\r\n    } else if (!tokenLocal && !token) {\r\n      if (IS_NOT_DEBUG)  window.location = \"https://www.google.com/\";\r\n    } else if (tokenLocal && !token) {\r\n      getQuyenUserVaCheck(tokenLocal);\r\n    } else if (tokenLocal && token) {\r\n      localStorage.setItem(\"USER_TOKEN\", token);\r\n      getQuyenUserVaCheck(token || tokenLocal);\r\n    }\r\n  }, [token]);\r\n\r\n  return (\r\n    <div>\r\n      <Header />\r\n\r\n      <Outlet />\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"kXAAA,MAAOA,MAAK,EAAIC,SAAS,KAAQ,OAAO,CACxC,OAASC,WAAW,CAAEC,WAAW,KAAQ,aAAa,CACtD,OAASC,MAAM,CAAEC,eAAe,KAAQ,kBAAkB,CAC1D,OAASC,YAAY,KAAQ,mCAAmC,CAChE,MAAOC,OAAM,KAAM,UAAU,CAC7B,OAASC,cAAc,KAAQ,0BAA0B,CACzD,MAAOC,MAAK,KAAM,OAAO,CAAC,wFAE1B,cAAe,SAASC,OAAM,EAAG,CAC/B,qBAAwCL,eAAe,EAAE,sDAAlDM,YAAY,sBAAEC,eAAe,sBACpC,GAAMC,MAAK,CAAGF,YAAY,CAACG,GAAG,CAAC,KAAK,CAAC,CACrC;AACA,GAAMC,aAAY,CAAG,IAAI,CACzB,GAAMC,oBAAmB,4FAAG,iBAAOC,UAAU,6KAEvBR,MAAK,CAAC,CACtBS,MAAM,CAAE,KAAK,CACbC,GAAG,CAAE,0DAA0D,CAC/DC,OAAO,CAAE,CACPC,aAAa,kBAAYJ,UAAU,CACrC,CACF,CAAC,CAAC,QANIK,GAAG,eAOT;AACMC,UAAU,CAAGf,cAAc,CAACc,GAAG,CAACE,IAAI,CAACC,OAAO,CAAE,OAAO,CAAC,CAC5D,GAAI,CAACF,UAAU,CAAE,CACf;AACA,GAAIR,YAAY,CAAKW,MAAM,CAACC,QAAQ,CAAG,yBAAyB,CAClE,CAAC,+EAEDC,OAAO,CAACC,GAAG,aAAO,CAClB,GAAId,YAAY,CAAGW,MAAM,CAACC,QAAQ,CAAG,yBAAyB,CAAC,oEAElE,kBAnBKX,oBAAmB,4CAmBxB,CAEDf,SAAS,CAAC,UAAM,CACd;AACA;AACA,GAAMgB,WAAU,CAAGa,YAAY,CAACC,OAAO,CAAC,YAAY,CAAC,CACrD,GAAI,CAACd,UAAU,EAAIJ,KAAK,CAAE,CACxBiB,YAAY,CAACE,OAAO,CAAC,YAAY,CAAEnB,KAAK,CAAC,CACzCG,mBAAmB,CAACC,UAAU,CAAC,CACjC,CAAC,IAAM,IAAI,CAACA,UAAU,EAAI,CAACJ,KAAK,CAAE,CAChC,GAAIE,YAAY,CAAGW,MAAM,CAACC,QAAQ,CAAG,yBAAyB,CAChE,CAAC,IAAM,IAAIV,UAAU,EAAI,CAACJ,KAAK,CAAE,CAC/BG,mBAAmB,CAACC,UAAU,CAAC,CACjC,CAAC,IAAM,IAAIA,UAAU,EAAIJ,KAAK,CAAE,CAC9BiB,YAAY,CAACE,OAAO,CAAC,YAAY,CAAEnB,KAAK,CAAC,CACzCG,mBAAmB,CAACH,KAAK,EAAII,UAAU,CAAC,CAC1C,CACF,CAAC,CAAE,CAACJ,KAAK,CAAC,CAAC,CAEX,mBACE,oCACE,KAAC,MAAM,IAAG,cAEV,KAAC,MAAM,IAAG,GACN,CAEV"},"metadata":{},"sourceType":"module","externalDependencies":[]}